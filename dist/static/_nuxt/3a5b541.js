(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{517:function(e,t,r){"use strict";r.r(t);var n=r(85),o=(r(217),{name:"Student",props:["liveClassProxy"],computed:{roomName:function(){return this.liveClassProxy.users[this.$store.state.user.email].room}},data:function(){return{liveRoomProxy:{},ready:!1}},mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.ready=!0;case 1:case"end":return t.stop()}}),t)})))()},methods:{}}),c=r(107),l=r(142),d=r.n(l),m=r(208),f=r(97),v=r(601),y=r(543),h=r(602),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-container",[r("div",[e.ready?r("v-row",{attrs:{justify:"center",align:"center"}},[r("v-col",{attrs:{cols:"12",sm:"10",md:"10"}},[r("v-card",[r("v-card-title",[e._v(e._s(e.$store.state.class_.name)+" â€“ "+e._s(e.roomName))]),e._v(" "),r("Modules",{attrs:{role:"student",username:e.$store.state.user.email,"live-class-proxy":e.liveClassProxy}})],1)],1)],1):e._e()],1)])],1)}),[],!1,null,"5893dd9c",null);t.default=component.exports;d()(component,{Modules:r(503).default}),d()(component,{VCard:m.a,VCardTitle:f.d,VCol:v.a,VContainer:y.a,VRow:h.a})},612:function(e,t,r){"use strict";r.r(t);r(59),r(65),r(26),r(12),r(72),r(84),r(15),r(11),r(16);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var o=r(516),c=r(143),l=r(85),d=(r(14),r(4),r(121),r(42),r(37),r(54),r(32),r(53),r(64),r(501),r(299),r(13),r(74),r(217),r(517));function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var h={name:"ClassPage",data:function(){return{ready:!1,liveClass:void 0,liveClassProxy:void 0,role:"",liveClassEventSource:void 0,isStation:!1,stationName:"",modulesLoaded:!1}},head:function(){return{title:"Class"}},watch:{"$store.state.class_.modules":function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var r,n,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.modulesLoaded=!1,r=[],n=v(e.$store.state.class_.modules),t.prev=3,n.s();case 5:if((o=n.n()).done){t.next=14;break}return c=o.value,t.t0=r,t.next=10,e.scrapeModule(c);case 10:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 12:t.next=5;break;case 14:t.next=19;break;case 16:t.prev=16,t.t2=t.catch(3),n.e(t.t2);case 19:return t.prev=19,n.f(),t.finish(19);case 22:e.$store.commit("setScrapedModules",r),e.modulesLoaded=!0;case 24:case"end":return t.stop()}}),t,null,[[3,16,19,22]])})))()},"$store.state.class_":function(e,t){var r=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var t,n,c,l,d,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.ready=!1,t=void 0,null!==r.$store.state.class_){e.next=6;break}t=f(f({},r.$store.state.user),{},{memberships:r.$store.state.user.memberships.filter((function(e){return e.class_id!=r.$route.params.id}))}),e.next=13;break;case 6:if(!r.$store.state.class_){e.next=11;break}(c=null===(n=r.$store.state.user.memberships)||void 0===n?void 0:n.find((function(e){return e.class_id==r.$route.params.id&&e.instance==r.$store.state.instance})))&&c.role==r.role&&c.class_name==r.$store.state.class_.name||(null!==(l=r.$store.state.class_.members.teacher)&&void 0!==l&&l.includes(localStorage.email)?r.role="teacher":null!==(d=r.$store.state.class_.members.student)&&void 0!==d&&d.includes(localStorage.email)&&(r.role="student"),t=f(f({},r.$store.state.user),{},{memberships:[{instance:r.$store.state.instance,class_id:r.$route.params.id,class_name:r.$store.state.class_.name,role:r.role}].concat(Object(o.a)(r.$store.state.user.memberships.filter((function(e){return e.class_id!=r.$route.params.id}))))})),e.next=13;break;case 11:return console.log("Undefined class"),e.abrupt("return");case 13:if(!t){e.next=19;break}return e.t0=r.$store,e.next=17,r.$axios.$get("/data/updateUser?user=".concat(encodeURIComponent(JSON.stringify(t))));case 17:e.t1=e.sent,e.t0.commit.call(e.t0,"setUser",e.t1);case 19:if(null!==r.$store.state.class_){e.next=23;break}return r.$router.push({path:"/"}),r.$emit("class-not-found"),e.abrupt("return");case 23:r.liveClassEventSource?r.ready=!0:((m=new URL("".concat(r.$store.state.instance,"/data/readLiveClass/").concat(r.$route.params.id))).searchParams.append("displayName",r.isStation?r.stationName:r.$store.state.user.displayName),m.searchParams.append("jwt",localStorage.jwt),r.isStation&&m.searchParams.append("isStation","true"),r.liveClassEventSource=new EventSource(m.href),r.liveClassEventSource.addEventListener("update",(function(e){r.liveClass=JSON.parse(e.data),r.buildLiveClassProxy(),r.ready=!0,Object.keys(r.liveClass.rooms).includes(r.liveClass.users[r.$store.state.user.email].room)||(r.liveClassProxy.users[r.$store.state.user.email].room="Lobby")})),r.liveClassEventSource.addEventListener("message",(function(e){r.$store.commit("setLastRecievedMessage",JSON.parse(e.data))})));case 24:case"end":return e.stop()}}),e)})))()}},mounted:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return window.location.hash.includes("#station")?(e.isStation=!0,e.stationName=localStorage.stationName||(new Date).getTime().toString()):(e.isStation=!1,e.stationName=void 0),t.next=3,e.fetchClass();case 3:case"end":return t.stop()}}),t)})))()},methods:{buildLiveClassProxy:function(){var e=this;this.liveClassProxy=new Proxy(this.liveClass,function t(path){return{get:function(e,r){if("isProxy"==r)return!0;var c=e[r];return void 0!==c?(c.isProxy||"object"!==n(c)||(e[r]=new Proxy(c,t([].concat(Object(o.a)(path),[r])))),e[r]):void 0},set:(r=Object(l.a)(regeneratorRuntime.mark((function t(r,n,c){var l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(path.includes("__ob__")){t.next=4;break}return l=[].concat(Object(o.a)(path),[n]),t.next=4,e.$axios.$get("/data/updateLiveClass/".concat(e.$store.state.class_.id,"?update=").concat(encodeURIComponent(JSON.stringify({path:l,value:c}))));case 4:return r[n]=c,t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)}))),function(e,t,n){return r.apply(this,arguments)})};var r}(""))},fetchClass:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=e.$store,t.next=4,e.$axios.$get("/data/readClass/".concat(e.$route.params.id));case 4:return t.t1=t.sent,t.t0.commit.call(t.t0,"setClass",t.t1),t.abrupt("return",!0);case 9:if(t.prev=9,t.t2=t.catch(0),404!=t.t2.response.status){t.next=14;break}return e.$store.commit("setClass",null),t.abrupt("return",!1);case 14:throw new Error("Unknown response in class page");case 15:case"end":return t.stop()}}),t,null,[[0,9]])})))()}},components:{Teacher:r(541).default,Student:d.default}},$=h,x=r(107),w=r(142),S=r.n(w),C=r(207),component=Object(x.a)($,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.ready&&e.modulesLoaded?r("div",["teacher"==e.role?r("Teacher",{attrs:{"live-class-proxy":e.liveClassProxy,"is-station":e.isStation,"station-name":e.stationName}}):"student"==e.role?r("Student",{attrs:{"live-class-proxy":e.liveClassProxy}}):e._e()],1):r("div",{attrs:{justify:"center",align:"center"}},[r("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)])}),[],!1,null,"36249cce",null);t.default=component.exports;S()(component,{Teacher:r(541).default,Student:r(517).default}),S()(component,{VProgressCircular:C.a})}}]);